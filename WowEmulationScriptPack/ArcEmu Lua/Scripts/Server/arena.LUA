local reset_time = 900 -- Time the theme will reset to normal and another theme can be chosen (900 = 15 min).

local entry_id = 200007 -- Put the entry id of your npc here.

local r_time
local go_table = {}

local forest_theme = 1
local marsh_theme = 2
local ocean_theme = 3
local horde_theme = 4
local mystic_theme = 5

local theme_table = {
	[forest_theme] = {
		{30000,-13213.6,305.464,21.858,4.84185,0},
		{30000,-13172.7,268.138,21.858,0.242687,0},
		{30000,-13208.6,244.124,21.858,1.22051,0},
		{30000,-13213.9,277.515,21.858,0.200561,0},
		{30001,-13213.4,271.912,21.8571,1.75389,0},
		{30001,-13211.8,272.494,21.8571,2.05783,0},
		{30001,-13215.2,272.05,21.8571,1.37847,0},
		{30001,-13213.6,300.406,21.8571,1.86934,0},
		{30001,-13212.9,300.537,21.8571,1.76567,0},
		{30001,-13175.8,271.679,21.8571,5.41614,0},
		{30001,-13176.3,271.227,21.8571,5.4397,0},
		{30001,-13174.8,272.873,21.8571,5.35174,0},
		{30001,-13176.4,272.202,21.8571,4.50351,0},
		{30001,-13202.8,243.211,21.8571,3.12121,0},
		{30001,-13202.9,244.207,21.8571,3.23116,0},
		{30001,-13211.2,248.314,21.858,5.39022,0},
		{30001,-13212.1,247.563,21.858,5.28027,0},
		{30001,-13213,246.845,21.858,5.43735,0},
		{30002,-13236.2,280.967,21.857,0.479923,0},
		{30003,-13191.8,289.481,21.8567,5.86461,0},
		{30003,-13195.3,292.13,21.8567,5.14519,0},
		{30003,-13187.2,288.549,21.8567,4.70223,0},
		{30003,-13179.3,266.729,21.8567,5.53475,0},
		{30003,-13176.7,261.065,21.8567,1.46717,0},
		{30003,-13203.4,249.716,21.8567,3.76053,0},
		{30003,-13209.4,250.895,21.8567,1.94626,0},
		{30003,-13221.8,308.571,21.8567,0.842777,0},
		{30003,-13217.4,312.036,21.8567,6.06568,0},
		{30003,-13207.7,312.2,21.8567,2.49997,0},
		{30003,-13219.4,281.345,21.8576,5.03288,0},
		{30003,-13220.3,275.993,21.8576,0.948807,0},
		{30003,-13188.8,297.035,21.8571,1.2072,0},
		{30003,-13183.2,292.458,21.8571,3.02342,0}
	},
	[marsh_theme] = {
		{30004,-13187.7,239.463,21.8582,3.77539,0,250},
		{30004,-13180.5,291.8,21.8582,3.22953,0,250},
		{30004,-13178.4,283.759,21.8579,4.64874,0,250},
		{30004,-13227.1,278.129,21.8582,5.76243,0,250},
		{30004,-13173.3,295.848,21.8579,4.20499,0,250},
		{30004,-13202.6,244.986,21.8579,2.8816,0,250},
		{30004,-13186.4,291.49,21.8579,5.90144,0,250},
		{30004,-13192.9,235.159,21.8582,3.5437,0,250},
		{30004,-13173.4,255.883,21.8582,4.31731,0,250},
		{30004,-13205.5,250.809,21.8582,2.8329,0,250},
		{30004,-13218.7,268.308,21.8582,5.81348,0,250},
		{30004,-13170.4,287.805,21.8582,2.30276,0,250},
		{30004,-13228,249.127,21.8582,5.77814,0,250},
		{30004,-13215.8,312.145,21.8582,0.928307,0,250},
		{30004,-13180.1,239.075,21.8579,5.35167,0,250},
		{30004,-13221.7,274.7,21.8571,4.26782,0,250},
		{30004,-13167.4,256.948,21.8579,6.12921,0,250},
		{30004,-13170.8,249.312,21.8579,5.68546,0,250},
		{30004,-13184.4,274.314,21.8582,5.65248,0,250},
		{30004,-13210.4,283.529,21.8582,5.86061,0,250},
		{30004,-13198.1,271.543,21.8582,2.64048,0,250},
		{30004,-13193.6,258.863,21.8582,2.69153,0,250},
		{30004,-13199.2,314.904,21.8582,1.06968,0,250},
		{30004,-13203.6,298.728,21.8582,6.15121,0,250},
		{30004,-13231.4,261.383,21.8571,4.62517,0,250},
		{30004,-13175.7,274.391,21.8579,5.77107,0,250},
		{30004,-13177.2,267.055,21.8579,0.591363,0,250},
		{30004,-13180.3,245.738,21.8582,3.9521,0,250},
		{30004,-13210.4,302.124,21.8582,4.39192,0,250},
		{30004,-13233.7,262.174,21.8582,4.16415,0,250},
		{30004,-13173.5,260.887,21.8582,5.30691,0,250},
		{30004,-13186.7,282.938,21.8582,4.39585,0,250},
		{30004,-13242.4,276.602,21.8573,0.159389,0,250},
		{30004,-13238.3,281.879,21.8573,0.921225,0,250},
		{30004,-13225.4,300.29,21.8573,3.53268,0,250},
		{30004,-13214.3,292.125,21.8573,4.3652,0,250},
		{30004,-13220.4,307.884,21.8573,1.96581,0,250},
		{30004,-13176.7,304.866,21.8573,1.06653,0,250},
		{30005,-13205.5,274.828,28.9149,4.27407,0,1300},
		{30006,-13205.8,274.844,27.6802,4.30156, 0},
		{30008,-13168.6,275.081,21.8574,2.72372, 0},
		{30007,-13233.6,293.37,21.8573,5.66896, 0}
	},
	[ocean_theme] = {
		{30010,-13206.5,275.269,37.9933,4.24822,0,1300},
		{30011,-13195.5,278.584,22.0169,4.09114,0},
		{30011,-13199.7,274.619,21.8572,4.22073,0},
		{30011,-13192.9,272.035,21.9394,2.42216,0},
		{30012,-13176.6,279.44,21.8575,2.01925,0},
		{30012,-13229.4,271.519,21.8575,5.45144,0},
		{30012,-13164.8,256.585,21.8575,0.376984,0},
		{30012,-13206.9,254.713,21.8575,0.296088,0},
		{30012,-13226.7,250.354,21.8575,5.45144,0},
		{30012,-13220.6,293.657,21.8575,4.73516,0},
		{30012,-13184.1,247.726,21.8575,0.140579,0},
		{30012,-13211.2,311.107,21.8575,4.90088,0},
		{30012,-13202.5,289.774,21.8575,3.59633,0},
		{30012,-13183.6,297.988,21.8575,2.87533,0},
		{30013,-13204.8,269.917,21.8582,3.97977,0},
		{30014,-13171,258.625,30.0242,3.61221,0},
		{30014,-13230.3,270.862,23.0879,6.02417,0},
		{30014,-13188.2,278.39,29.0579,4.97331,0},
		{30014,-13214.2,261.639,28.8775,5.76027,0},
		{30014,-13225.4,242.14,30.0242,5.76027,0},
		{30014,-13178.3,295.883,29.1114,2.5582,0},
		{30014,-13220.6,299.088,29.1114,5.54743,0},
		{30014,-13195.3,245.248,30.0242,1.5906,0},
		{30015,-13217.1,251.336,31.2398,5.3927,0}
	},
	[horde_theme] = {
		{30016,-13195.2,278.438,21.8573,1.54162,0},
		{30016,-13203.1,285.581,21.8575,2.63725,0},
		{30016,-13213.9,282.499,21.8573,3.64705,0},
		{30016,-13208.9,285.838,21.8577,3.66309,0},
		{30016,-13197.8,282.83,21.8574,2.63725,0},
		{30016,-13216.6,277.711,21.858,4.7318,0},
		{30016,-13216.5,271.729,21.8577,4.7318,0},
		{30016,-13213.8,266.83,21.8573,5.82186,0},
		{30016,-13208.4,264.131,21.8581,5.82186,0},
		{30017,-13205.7,275.016,7.16591,4.23756,0 },
		{30019,-13232.3,239.939,33.4345,1.0336,0},
		{30019,-13216.6,231.872,33.419,1.03282,0},
		{30018,-13237.2,273.418,21.8574,5.14202,0},
		{30018,-13176.9,254.606,21.8578,3.58929,0}
	},
	[mystic_theme] = {
		{185491,-13216.81,246.61,21.86,1.3,0,10},
		{185491,-13232.33,285.526,21.86,6.03,0,10},
		{185491,-13196.26,303.53,21.86,4.35,0,10},
		{185491,-13172.15,265.79,21.86,2.83,0,10},
		{177414,-13197,274.56,21.86,2.83,0,200},
		{177414,-13208.54,268.58,21.86,1.25,0,200},
		{177414,-13214.16,279.74,21.86,5.97,0,200},
		{177414,-13203.11,286.16,21.86,4.45,0,200},
		{181360,-13205.65,277.48,21.86,4.38,0},
		{177415,-13205.65,277.48,21.86,4.38,0},
		{178964,-13205.65,277.48,21.86,4.38,0,1600},
		{177414,-13205.65,277.48,21.86,4.38,0,3000},
		{3267260,-13205.8,277.73,29.33,1.2,0,500},
		{3267417,-13235.75,268.24,21.86,5.8,0,200}
	}
}	

function on_theme_speak(pUnit, _, plr)
	if not (r_time) or (os.time() >= r_time) then
		pUnit:GossipCreateMenu(50020, plr, 0)
		pUnit:GossipMenuAddItem(0, "Forest Theme", 1, 0)
		pUnit:GossipMenuAddItem(0, "Marsh Theme", 2, 0)
		pUnit:GossipMenuAddItem(0, "Ocean Theme", 3, 0)
		pUnit:GossipMenuAddItem(0, "Horde Theme", 4, 0)
		pUnit:GossipMenuAddItem(0, "Mystic Theme", 5, 0)
		pUnit:GossipSendMenu(plr)
	elseif (plr:CanUseCommand("a")) then
		pUnit:GossipCreateMenu(50020, plr, 0)
		pUnit:GossipMenuAddItem(0, "Despawn Theme", 6, 0)
		pUnit:GossipSendMenu(plr)
	else
		plr:SendBroadcastMessage("You have to wait "..r_time - os.time().." more seconds.")
	end
end	

function on_theme_spawn(pUnit, _, plr, _, intid)
	if (intid == 6) then
		r_time = os.time();
		return plr:GossipComplete();
	end
	local tbl = theme_table[intid]
	for info in pairs(tbl) do
		local object = pUnit:SpawnGameObject(unpack(tbl[info]))
		table.insert(go_table, object)
	end
	r_time = os.time() + reset_time
	plr:GossipComplete()
end	

function on_theme_delete()
	if (r_time) and (os.time() >= r_time) then
		for k, object in pairs(go_table) do
			if (object:IsInWorld()) then
				object:Despawn(0, 0)
				go_table[k] = nil;
			end	
		end
		r_time = nil;
	end
end	

RegisterTimedEvent("on_theme_delete", 1000, 0)

RegisterUnitGossipEvent(200007, 1, "on_theme_speak")
RegisterUnitGossipEvent(200007, 2, "on_theme_spawn")